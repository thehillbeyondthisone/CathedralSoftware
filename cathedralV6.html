<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gatekeeper - Internal Systems FINAL v2.8</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');
        
        :root {
            --base-grey: #c0c0c0;
            --shadow-dark: #808080;
            --shadow-light: #dfdfdf;
            --cathedral-dark: #5a0000;
            --cathedral-light: #9d3434;
            --menu-blue-dark: #000080;
            --menu-blue-light: #1084d0;
            --terminal-bg: #000000;
            --terminal-text: #00ff88;
            --terminal-warn: #ff2222;
            --terminal-success: #44ff44;
            --terminal-cmd: #ffff44;
            --terminal-progress: #44aaff;
            --access-denied-red: #9d3434;
            --access-granted-green: #3d8f3d;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Courier Prime', monospace;
            font-size: 12px;
            background: #000;
            overflow: hidden;
            color: #ff6600;
            user-select: none;
        }
        
        .monitor {
            width: 100vw;
            height: 100vh;
            background: #1a1a1a;
            position: relative;
            border: 12px solid #2a2a2a;
            border-radius: 8px;
            box-shadow: 0 0 40px rgba(0,0,0,0.8) inset, 0 0 20px #000;
            transition: filter 1s, opacity 0.5s;
        }
        
        .desktop {
            width: 100%;
            height: 100%;
            background-color: #3a3a7a;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #wallpaper-logo-container {
            width: 350px;
            height: 350px;
            opacity: 0.2;
            position: relative;
        }
        
        .desktop::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: repeating-linear-gradient(0deg, rgba(255,255,255,0.02), rgba(255,255,255,0.02) 1px, transparent 1px, transparent 2px);
            pointer-events: none;
            animation: scanlines 0.2s linear infinite;
        }

        .desktop::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(18, 16, 16, 0.1);
            opacity: 0;
            pointer-events: none;
            animation: flicker 0.15s infinite;
        }
        
        @keyframes scanlines { from { transform: translateY(0); } to { transform: translateY(2px); } }
        @keyframes flicker { 0% { opacity: 0.1; } 20% { opacity: 1; } 80% { opacity: 0.3; } 100% { opacity: 1; } }
        
        .pi-symbol {
            position: absolute;
            bottom: 30px; right: 20px;
            font-size: 38px; color: #ff3333; font-weight: bold;
            text-shadow: 0 0 15px #ff3333, 0 0 25px #ff3333;
            animation: pulse-pi 3s infinite;
            cursor: pointer; transition: all 0.4s ease; z-index: 10;
            filter: drop-shadow(0 0 8px #ff3333);
        }
        
        .pi-symbol:hover {
            transform: scale(1.3) rotate(5deg);
            text-shadow: 0 0 25px #ff3333, 0 0 40px #ff3333;
            filter: drop-shadow(0 0 15px #ff3333);
        }
        
        @keyframes pulse-pi { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }
        
        .main-menu-window { position: absolute; top: 60px; left: 120px; width: 650px; height: 420px; z-index: 100; }
        .terminal-window { position: absolute; bottom: 25px; right: 15px; width: 520px; height: 420px; z-index: 150; }
        .network-window { position: absolute; top: 150px; left: 180px; width: 400px; height: 280px; z-index: 80; }
        .firesystem-window { position: absolute; top: 100px; left: 50%; transform: translateX(-50%); width: 500px; height: 350px; z-index: 120; }

        .window {
            background: var(--base-grey);
            border: 2px outset var(--shadow-light);
            box-shadow: 8px 8px 16px rgba(0,0,0,0.6);
            border-radius: 2px;
            display: flex;
            flex-direction: column;
            animation: window-open 0.3s ease-out;
        }
        @keyframes window-open { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        
        .title-bar {
            height: 26px;
            background: linear-gradient(to right, var(--cathedral-dark), var(--cathedral-light));
            color: white; font-weight: bold; font-size: 12px;
            display: flex; align-items: center; padding: 0 8px;
            justify-content: space-between; cursor: grab;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            transition: filter 0.2s;
        }
        
        .title-bar.dragging { filter: brightness(1.2); }
        .title-bar:active { cursor: grabbing; }
        .window-controls { display: flex; gap: 3px; }
        
        .control-btn {
            width: 18px; height: 16px; border: 2px outset var(--base-grey);
            background: var(--base-grey); font-size: 10px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; color: black; transition: all 0.1s; font-weight: bold;
        }
        
        .control-btn:hover { background: #d0d0d0; }
        .control-btn:active { border: 2px inset var(--base-grey); }
        
        .menu-area { flex-grow: 1; background: var(--cathedral-dark); position: relative; overflow: hidden; display: flex; }
        .sidebar { width: 130px; height: 100%; background: var(--base-grey); border-right: 2px solid var(--shadow-dark); padding: 8px 4px; }
        
        .menu-button {
            width: 100%; height: 38px; margin: 4px 0; background: var(--base-grey);
            border: 2px outset var(--base-grey); color: black; font-size: 10px; font-weight: bold;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: all 0.2s; text-shadow: 1px 1px 0px rgba(255,255,255,0.7);
        }
        
        .menu-button:hover { background: #d0d0d0; }
        .menu-button:active, .menu-button.selected { background: #a0a0a0; border: 2px inset var(--base-grey); }

        .main-content { flex-grow: 1; background: var(--cathedral-dark); padding: 18px; }
        
        .content-header {
            color: white; font-size: 15px; font-weight: bold; margin-bottom: 18px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7); text-align: center; background: rgba(0,0,0,0.2);
            padding: 8px; border-radius: 3px; border: 1px solid rgba(255,255,255,0.3);
        }
        
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 18px; height: calc(100% - 60px); }
        
        .menu-item {
            background: var(--base-grey); border: 4px double var(--base-grey); padding: 12px;
            transition: all 0.3s; display: flex; flex-direction: column; align-items: center;
            justify-content: center; text-align: center; color: black; font-weight: bold;
            text-shadow: 1px 1px 0px rgba(255,255,255,0.7); border-radius: 4px; position: relative; overflow: hidden;
        }
        .menu-item-text { display: flex; align-items: center; gap: 5px; }
        
        .menu-item.accessible {
            cursor: pointer;
            border-color: var(--access-granted-green);
        }
        .menu-item.accessible:hover { background: #d0d0d0; transform: scale(1.03); }
        .menu-item.accessible:active { border-style: inset; transform: scale(0.98); }

        .menu-item.denied {
            cursor: not-allowed;
            border-color: var(--access-denied-red);
            color: #555;
            background: #a0a0a0;
        }
        .menu-item.denied .lips-logo { filter: grayscale(100%) brightness(0.7); animation: none; }
        
        .menu-item.fully-accessible {
            border-color: var(--terminal-success);
            box-shadow: 0 0 15px rgba(0,255,0,0.4) inset, 0 0 15px rgba(0,255,0,0.4);
            animation: glow-green 2s infinite;
        }
        
        .menu-item.highlighted {
            border-color: #ff9900;
            background: #ffe0b3;
        }

        @keyframes glow-green {
            0%, 100% { box-shadow: 0 0 15px rgba(0,255,0,0.4) inset, 0 0 15px rgba(0,255,0,0.4); }
            50% { box-shadow: 0 0 25px rgba(0,255,0,0.7) inset, 0 0 25px rgba(0,255,0,0.7); }
        }
        
        .lips-logo {
            width: 45px; height: 28px; background: radial-gradient(ellipse, #FF4444 20%, #DD2222 60%, #BB0000 90%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%; margin-bottom: 10px; position: relative;
            animation: lips-glow 4s infinite; filter: drop-shadow(0 0 8px #FF4444);
        }
        
        .lips-logo::after {
            content: ''; position: absolute; top: 50%; left: 50%; width: 32px; height: 2px;
            background: #880000; transform: translate(-50%, -50%); border-radius: 1px;
            box-shadow: inset 0 1px 1px rgba(0,0,0,0.3);
        }
        
        @keyframes lips-glow {
            0%, 100% { filter: drop-shadow(0 0 8px #FF4444); transform: scale(1); }
            50% { filter: drop-shadow(0 0 18px #FF4444) drop-shadow(0 0 25px #FF4444); transform: scale(1.05); }
        }
        
        .terminal-area {
            flex-grow: 1; background: var(--terminal-bg);
            color: var(--terminal-text); font-family: 'Courier Prime', monospace; font-size: 11px;
            padding: 10px; overflow-y: auto; position: relative; border: 2px inset #000;
        }

        .terminal-output .trace-line > span {
            text-shadow: 0 0 8px, 0 0 5px rgba(180, 255, 220, 0.5);
            animation: text-ghost 2s infinite alternate;
        }
        @keyframes text-ghost { from { text-shadow: 0 0 8px, 0 0 5px rgba(180, 255, 220, 0.5); } to { text-shadow: 0 0 2px, 0 0 2px rgba(180, 255, 220, 0.2); } }
        
        .trace-line { margin: 1px 0; min-height: 14px; font-size: 11px; line-height: 1.4; white-space: pre-wrap;}
        .timestamp { color: #888; margin-right: 10px; font-weight: bold; }
        .command { color: var(--terminal-cmd); }
        .response { color: var(--terminal-text); }
        .error { color: var(--terminal-warn); }
        .success { color: var(--terminal-success); }
        .header-info { color: #ff8844; }
        .trace-progress { color: var(--terminal-progress); animation: glow-blue 2s infinite; }
        .cathedral-warning { color: var(--terminal-warn); font-weight: bold; animation: urgent-flash 1.2s infinite; }
        .flashing-text { animation: urgent-flash 0.8s infinite; }
        
        @keyframes glow-blue { 0%, 100% { text-shadow: 0 0 3px var(--terminal-progress); } 50% { text-shadow: 0 0 8px var(--terminal-progress); } }
        @keyframes urgent-flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        
        .cursor { background: var(--terminal-text); color: #000; animation: blink 1s infinite; padding: 0 1px;}
        @keyframes blink { 0%, 50% { opacity: 1; } 51%, 100% { opacity: 0; } }

        .terminal-input-line { display: flex; }
        .terminal-prompt { color: var(--terminal-cmd); }
        #commandInput, #confirmInput {
            flex-grow: 1; background: transparent; border: none; color: var(--terminal-cmd);
            font-family: 'Courier Prime', monospace; font-size: 11px; outline: none;
        }
        
        .hidden { display: none !important; }
        
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: flex; align-items: center;
            justify-content: center; z-index: 2000; backdrop-filter: blur(2px);
        }
        
        .modal {
            background: var(--base-grey); border: 2px outset var(--shadow-light); padding: 2px;
            width: 450px; color: black; border-radius: 4px;
            box-shadow: 0 0 30px rgba(0,0,0,0.8); animation: modal-appear 0.3s ease-out;
        }

        .modal-title-bar {
            height: 26px; background: linear-gradient(to right, #800000, #d01010);
            color: white; font-weight: bold; font-size: 12px; display: flex;
            align-items: center; padding: 0 8px; justify-content: space-between;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }
        
        @keyframes modal-appear { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .modal-body { padding: 20px; text-align: center; }
        .modal-content { margin-bottom: 20px; font-size: 12px; line-height: 1.4; }
        .modal-input {
            background: #fff; border: 2px inset var(--shadow-dark); padding: 5px;
            font-family: 'Courier Prime', monospace; width: 80%; margin-bottom: 10px;
        }

        .modal-btn {
            margin: 6px 4px; padding: 8px 12px; background: var(--base-grey);
            border: 2px outset var(--base-grey); color: black; cursor: pointer;
            font-weight: bold; font-size: 11px; transition: all 0.2s;
        }
        
        .modal-btn:hover { background: #d0d0d0; }
        .modal-btn:active { border: 2px inset var(--base-grey); }
        
        .modal-btn.override, .modal-btn.danger { background: #d9534f; border-color: #d43f3a; color: white; }
        .modal-btn.override:hover, .modal-btn.danger:hover { background: #c9302c; }

        .data-list { list-style: none; text-align: left; margin: 15px auto; width: 90%; border: 1px inset var(--shadow-dark); background: #fff; padding: 5px; height: 150px; overflow-y: auto;}
        .data-list li { padding: 4px 8px; cursor: pointer; font-size: 10px; }
        .data-list li:hover { background: var(--menu-blue-dark); color: white; }
        .data-list li.selected { background: #333; color: white; }
        .data-list li.protected { color: #a00; font-weight: bold; }
        .data-list li.locked { color: #777; cursor: not-allowed; }
        .redacted { background-color: black; color: black; }

        .status-bar {
            position: absolute; bottom: 0; left: 0; right: 0; height: 24px;
            background: var(--base-grey); border-top: 2px solid var(--shadow-dark); display: flex;
            align-items: center; padding: 0 10px; font-size: 10px; color: #000;
        }
        
        .status-item {
            margin-right: 15px; display: flex; align-items: center;
            gap: 5px; border: 1px inset var(--shadow-dark); padding: 1px 5px;
        }
        
        .status-led {
            width: 8px; height: 8px; border-radius: 50%; background: var(--terminal-success);
            animation: pulse-led 2s infinite; box-shadow: 0 0 5px var(--terminal-success);
        }
        
        @keyframes pulse-led { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }
        .status-led.warning { background: #ffaa00; box-shadow: 0 0 5px #ffaa00; }
        .status-led.error { background: var(--terminal-warn); box-shadow: 0 0 5px var(--terminal-warn); }

        .bsod {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: #000080; color: #fff; z-index: 9999;
            font-family: 'Courier Prime', monospace;
            padding: 20px; text-align: center;
            opacity: 0;
            animation: fadeInBSOD 0.5s forwards;
        }
        @keyframes fadeInBSOD { to { opacity: 1; }}
        .bsod h1 { font-size: 24px; margin-bottom: 30px; }
        
        .desktop-icons {
            position: absolute;
            top: 30px;
            left: 30px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 1;
        }
        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 80px;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
        }
        .desktop-icon:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .desktop-icon svg {
            width: 48px;
            height: 48px;
            margin-bottom: 5px;
        }
        .desktop-icon span {
            color: white;
            font-size: 11px;
            text-shadow: 1px 1px 2px #000;
        }
        
        #alert-banner {
            position: fixed; top: -100px; left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(to right, #800000, #d01010);
            color: white;
            padding: 10px 20px;
            border-radius: 0 0 5px 5px;
            z-index: 3000;
            font-weight: bold;
            text-shadow: 1px 1px 2px #000;
            transition: top 0.5s ease-in-out;
        }
        #alert-banner.show { top: 0; }
        
        .global-menu-bar {
            position: absolute; top: 0; left: 0; right: 0;
            background: var(--menu-blue-dark);
            color: white;
            height: 21px;
            border-bottom: 1px solid var(--shadow-dark);
            display: flex;
            align-items: center;
            padding: 0 5px;
            z-index: 500;
        }
        .menu-bar-item {
            padding: 2px 8px;
            cursor: pointer;
            font-size: 11px;
            position: relative;
        }
        .menu-bar-item:hover {
            background: var(--menu-blue-light);
            color: white;
        }
        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--menu-blue-dark);
            color: white;
            border: 2px outset var(--shadow-light);
            min-width: 150px;
            z-index: 501;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.5);
        }
        .menu-bar-item:hover .dropdown-menu {
            display: block;
        }
        .dropdown-item {
            padding: 5px 10px;
            font-size: 11px;
        }
        .dropdown-item:hover {
            background: var(--menu-blue-light);
        }
        .dropdown-separator {
            height: 1px;
            background: var(--shadow-dark);
            margin: 2px 0;
            border-bottom: 1px solid var(--shadow-light);
        }

        #pixel-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 9998;
            display: grid;
        }
        .pixel { background-color: rgba(0,0,0,0.8); }

        .firesystem-content {
            flex-grow: 1;
            background: #333;
            padding: 10px;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        .floorplan {
            width: 100%;
            flex-grow: 1;
        }
        .fire-zone {
            cursor: pointer;
            fill: #444;
            stroke: #ccc;
            stroke-width: 0.5;
            transition: fill 0.2s;
        }
        .fire-zone:hover {
            fill: #ff9900;
        }
        .fire-zone.active {
            animation: fire-alarm 0.5s infinite;
        }
        @keyframes fire-alarm {
            0%, 100% { fill: #ff0000; }
            50% { fill: #ff9900; }
        }
        
        .network-monitor-content {
            flex-grow: 1; background: #222; color: var(--terminal-text);
            padding: 10px; display: flex; flex-direction: column; gap: 10px;
        }
        .gauge-container { display: flex; flex-direction: column; align-items: center; }
        .gauge-label { font-size: 10px; color: #aaa; margin-bottom: 5px; }
        .gauge {
            width: 120px; height: 60px; border: 1px solid #555; border-bottom: none;
            border-radius: 60px 60px 0 0; position: relative; overflow: hidden;
            background: linear-gradient(to right, #0a0, #aa0, #a00);
        }
        .gauge-needle {
            width: 2px; height: 55px; background: #fff;
            position: absolute; bottom: 0; left: 59px;
            transform-origin: bottom center; transition: transform 0.5s;
        }
        .data-readout {
            border: 1px inset #444; padding: 5px; background: #000;
            font-size: 10px; text-align: center;
        }
        .server-status { flex-grow: 1; border: 1px inset #444; padding: 5px; background: #000; }
        .hex-dump { font-size: 9px; white-space: pre; color: #888; }

        .firewall-rule { display: flex; justify-content: space-between; align-items: center; padding: 4px; font-size: 10px; }
        .firewall-rule:nth-child(odd) { background: #e0e0e0; }
        .toggle-switch { width: 34px; height: 14px; background: #ccc; border-radius: 7px; position: relative; cursor: pointer; border: 1px inset; }
        .toggle-switch::after { content: ''; position: absolute; top: -1px; left: -1px; width: 14px; height: 14px; background: white; border-radius: 50%; transition: transform 0.2s; border: 1px outset; }
        .toggle-switch.active { background: #4CAF50; }
        .toggle-switch.active::after { transform: translateX(20px); }

    </style>
</head>
<body>
    <div class="monitor">
        <div class="desktop">
            <div id="wallpaper-logo-container">
                <svg width="100%" height="100%" viewBox="0 0 100 100">
                    <defs>
                        <filter id="crt-distort">
                            <feGaussianBlur in="SourceGraphic" stdDeviation="0.2" />
                        </filter>
                        <mask id="cutout">
                            <rect width="100" height="100" fill="white"/>
                            <rect x="5" y="45" width="90" height="10" fill="black"/>
                        </mask>
                    </defs>
                    <g filter="url(#crt-distort)">
                        <circle cx="50" cy="50" r="40" stroke="#ff00ff" stroke-width="8" fill="none" mask="url(#cutout)"/>
                        <rect x="0" y="42" width="100" height="16" fill="#909090"/>
                        <text x="50" y="54" font-family="'Courier Prime', monospace" font-size="10" fill="black" text-anchor="middle" font-weight="bold">Cathedral</text>
                    </g>
                </svg>
            </div>

            <div class="global-menu-bar">
                <div class="menu-bar-item">File
                    <div class="dropdown-menu">
                        <div class="dropdown-item" onclick="handleMenuAction('logoff')">Log Off</div>
                    </div>
                </div>
                <div class="menu-bar-item">System
                     <div class="dropdown-menu">
                        <div class="dropdown-item" onclick="handleMenuAction('diagnostics')">Run Diagnostics</div>
                        <div class="dropdown-item" onclick="handleMenuAction('network_status')">Network Status</div>
                        <div class="dropdown-separator"></div>
                        <div class="dropdown-item" onclick="handleMenuAction('reboot')">Reboot...</div>
                    </div>
                </div>
                <div class="menu-bar-item">Help
                     <div class="dropdown-menu">
                        <div class="dropdown-item" onclick="handleMenuAction('about')">About Gatekeeper...</div>
                    </div>
                </div>
            </div>

            <div id="pixel-overlay"></div>
            <div id="alert-banner"></div>

            <div class="desktop-icons">
                <div class="desktop-icon" id="cathedral-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7V17L12 22L22 17V7L12 2ZM12 4.236L19.962 8.5L12 12.764L4.038 8.5L12 4.236ZM4 9.815L12 14.185V20.01L4 15.64V9.815ZM20 15.64L12 20.01V14.185L20 9.815V15.64Z" fill="white"/></svg>
                    <span>Cathedral Systems</span>
                </div>
                <div class="desktop-icon" id="network-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 17H22V19H2V17H4V10C4 5.58172 7.58172 2 12 2C16.4183 2 20 5.58172 20 10V17ZM18 10C18 6.68629 15.3137 4 12 4C8.68629 4 6 6.68629 6 10V17H18V10ZM10 20H14V22H10V20Z" fill="white"/></svg>
                    <span>Network Activity</span>
                </div>
            </div>

            <div class="pi-symbol" onclick="triggerPiExploit()" title="Activate 'Mozart's Ghost' Backdoor">Ï€</div>
            
            <div class="window main-menu-window hidden" id="mainMenu">
                <div class="title-bar"><span>Cathedral Systems Menu v3.2</span></div>
                <div class="menu-area">
                    <div class="sidebar" id="mainSidebar">
                        </div>
                    <div class="main-content">
                        <div class="content-header" id="contentHeader">Cathedral Software Internal Systems Menu</div>
                        <div class="menu-grid" id="menuGrid"></div>
                    </div>
                </div>
            </div>
            
            <div class="window terminal-window" id="terminalWindow">
                <div class="title-bar"><span>Terminal Echo v2.1 - Secure Communications</span></div>
                <div class="terminal-area" id="terminal">
                    <div class="terminal-header">
                        <span id="userStatus">USER: A.BENNETT@CATHEDRAL.COM - ACCESS LEVEL: 3 (GUEST)</span>
                    </div>
                    <div id="terminalOutput"></div>
                    <div class="trace-line terminal-input-line" id="main-input-line">
                        <span class="terminal-prompt">$ </span>
                        <span id="commandInput" contenteditable="false"></span>
                        <span class="cursor">â–ˆ</span>
                    </div>
                </div>
            </div>
            
             <div class="window network-window hidden" id="networkWindow">
                <div class="title-bar"><span>Network Monitor</span></div>
                <div class="network-monitor-content">
                    <div class="gauge-container">
                        <div class="gauge-label">UPLINK (Gbps)</div>
                        <div class="gauge"><div class="gauge-needle" id="uplink-needle"></div></div>
                    </div>
                     <div class="gauge-container">
                        <div class="gauge-label">DOWNLINK (Gbps)</div>
                        <div class="gauge"><div class="gauge-needle" id="downlink-needle"></div></div>
                    </div>
                    <div class="data-readout">
                        <div>PACKET FLOW: <span id="packet-flow">0</span> p/s</div>
                        <div>LATENCY: <span id="latency">0</span> ms</div>
                    </div>
                     <div class="server-status">
                        <div id="server-status-text">SERVER STATUS: <span class="success">NOMINAL</span></div>
                        <div class="hex-dump" id="hex-dump"></div>
                    </div>
                </div>
            </div>

            <div class="window firesystem-window hidden" id="fireSystemWindow">
                <div class="title-bar"><span>Fire Suppression Control</span></div>
                <div class="firesystem-content">
                    <svg class="floorplan" viewBox="0 0 200 130">
                        <rect x="5" y="5" width="190" height="120" fill="#666" stroke="#ccc" stroke-width="1"/>
                        <rect class="fire-zone" data-zone="SERVER ROOM" x="10" y="10" width="80" height="40" />
                        <text x="50" y="32" font-size="6" fill="#fff" text-anchor="middle" pointer-events="none">SERVER ROOM</text>
                        <rect class="fire-zone" data-zone="DATA ARCHIVE" x="95" y="10" width="100" height="110"/>
                        <text x="145" y="65" font-size="6" fill="#fff" text-anchor="middle" pointer-events="none">DATA ARCHIVE</text>
                        <rect class="fire-zone" data-zone="CUBICLE BAY A" x="10" y="55" width="38" height="30"/>
                        <text x="29" y="72" font-size="4" fill="#fff" text-anchor="middle" pointer-events="none">CUBICLES A</text>
                        <rect class="fire-zone" data-zone="CUBICLE BAY B" x="52" y="55" width="38" height="30"/>
                        <text x="71" y="72" font-size="4" fill="#fff" text-anchor="middle" pointer-events="none">CUBICLES B</text>
                        <rect class="fire-zone" data-zone="BREAK ROOM" x="10" y="90" width="80" height="30"/>
                        <text x="50" y="107" font-size="6" fill="#fff" text-anchor="middle" pointer-events="none">BREAK ROOM</text>
                    </svg>
                    <div class="modal-btn danger" id="cancelAlarmBtn" style="margin-top: 5px; width: 100%;">CANCEL ALARM</div>
                </div>
            </div>

            <div id="systemModal" class="modal-overlay hidden">
                <div class="modal">
                    <div class="modal-title-bar">
                        <span id="modalTitle">GATEKEEPER SECURITY SYSTEM</span>
                        <div class="control-btn" id="modalCloseBtn">Ã—</div>
                    </div>
                    <div class="modal-body" id="modalBody">
                        </div>
                </div>
            </div>
            
            <div class="status-bar">
                <div class="status-item"><div class="status-led" id="systemLed"></div><span>System: Online</span></div>
                <div class="status-item"><div class="status-led" id="networkLed"></div><span>Network: Connected</span></div>
                <div class="status-item"><div class="status-led error" id="securityLed"></div><span id="securityStatus">Security: Active</span></div>
                <div class="status-item"><span id="userTypeStatus">USER TYPE: GUEST</span></div>
                <div class="status-item"><span id="systemLoadStatus">SYSTEM LOAD: NOMINAL</span></div>
                <div class="status-item" style="margin-left: auto;"><span id="currentTime"></span></div>
            </div>
        </div>
    </div>

    <script>
        // --- GLOBAL STATE ---
        let clearanceLevel = 3;
        const terminalInput = document.getElementById('commandInput');
        const terminalOutput = document.getElementById('terminalOutput');
        const terminal = document.getElementById('terminal');
        let terminalState = 'command'; // Can be 'command', 'confirm', 'reboot_confirm', 'backup_confirm'
        let activeAlarmTimers = [];

        // --- DATA ---
        const menuConfigs = {
            programs: { header: "Internal Systems Menu", items: [ {id: 'network-routing', name: 'Internetwork Routing Protocol', requiredLevel: 6}, {id: 'hr-storage', name: 'H.R. Storage', requiredLevel: 3}, {id: 'optical-archive', name: 'Optical Archive', requiredLevel: 6}, {id: 'mail-server', name: 'Mail Server', requiredLevel: 3}, {id: 'file-server', name: 'File Server', requiredLevel: 3}, {id: 'facilities-mgmt', name: 'Facilities Mgmt', requiredLevel: 6}]},
            systems: { header: "System & Monitoring Tools", items: [ {id: 'user-mgmt', name: 'User Management', requiredLevel: 9}, {id: 'security-audit', name: 'Security Audit', requiredLevel: 3}, {id: 'backup-sys', name: 'Backup System', requiredLevel: 6}, {id: 'sys-integrity', name: 'System Integrity', requiredLevel: 9}, {id: 'firewall', name: 'Firewall Control', requiredLevel: 9}, {id: 'database', name: 'DB Admin', requiredLevel: 6}]},
            commands: { header: "System Commands", items: [ {id: 'modem-link', name: 'Remote Modem Link', requiredLevel: 3}, {id: 'task-manager', name: 'Process Task Manager', requiredLevel: 6}]}
        };
        
        const fileSystem = {
            'DELETIONS.LOG': { content: `[21:03:14] User 'A.BENNETT' flagged for deletion by 'PRAETORIAN_GUARD'.\n[21:03:15] DELETING SSN...\n[21:03:15] DELETING CRIMINAL RECORD...\n[21:03:16] DELETING FINANCIAL HISTORY...\n[21:03:18] DELETING DRIVER'S LICENSE...\n[21:03:20] ASSIGNING NEW IDENTITY: RUTH MARX, ID: 458-00-3265`, requiredLevel: 3 },
            'PRAETORIANS.TXT': { content: `MEMO\nTO: J.DEVLIN\nFROM: <REDACTED>\nRE: The Praetorians\nOur group remains anonymous. Our influence grows through the Gatekeeper software. Any analyst, like Bennett, who gets too close must be ghosted.`, requiredLevel: 3 },
            'MOZART.MSG': { content: `--- MESSAGE FRAGMENT ---\n...found a backdoor. It's beautiful, like a Mozart's Ghost in the machine. There's a symbol, a simple Ï€ in the corner of the GUI. If you can get to it, you can bypass Gatekeeper entirely.`, requiredLevel: 6 },
            'GATEKEEPER.SYS': { content: `// GATEKEEPER v2.8 SYSTEM CONFIG\n[BACKDOOR]\nACTIVATION_KEY=PI_SYMBOL_CLICK\nACCESS_LEVEL=ROOT`, requiredLevel: 9 },
            'VIRUS_PAYLOAD.TXT': { content: `To neutralize Gatekeeper, the 'Praetorian Guard' failsafe must be triggered.\n\nOnce full administrative control is established (see MOZART.MSG), use the 'exec_payload' command with the 'wolfenstein3d.exe' package.\n\nThis will cause a cascading kernel failure, effectively destroying the system from within.`, requiredLevel: 6 }
        };

        const emails = [
            { subject: "Urgent: Incident 7G", from: "J.DEVLIN", body_redacted: "The analyst's account (BENNETT, A.) has been flagged. Per protocol, initiate ghosting procedures. Ensure all network access logs related to <span class='redacted'>the Praetorian project</span> are scrubbed. No trace.", body_clear: "The analyst's account (BENNETT, A.) has been flagged. Per protocol, initiate ghosting procedures. Ensure all network access logs related to the Praetorian project are scrubbed. No trace." },
            { subject: "RE: Mozart", from: "&lt;UNKNOWN&gt;", body_redacted: "The contingency is in place. If containment is breached, the <span class='redacted'>wolfenstein3d.exe</span> package is the failsafe. It will trigger a total kernel panic. This is a one-way street. They won't see it coming.", body_clear: "The contingency is in place. If containment is breached, the wolfenstein3d.exe package is the failsafe. It will trigger a total kernel panic. This is a one-way street. They won't see it coming." }
        ];

        const processList = [
            {pid: 101, name: 'system.exe', user: 'SYSTEM'}, {pid: 230, name: 'svchost.exe', user: 'SYSTEM'},
            {pid: 455, name: 'explorer.exe', user: 'a.bennett'}, {pid: 489, name: 'gatekeeper.exe', user: 'SYSTEM', protected: true},
            {pid: 512, name: 'terminal.exe', user: 'a.bennett'},
        ];

        const commandList = { 
            'help': 'Lists all available commands.', 
            'ask [query]': 'Ask the system AI for assistance (Lvl 9+).',
            'cat [filename]': 'Displays the content of a file.', 
            'trace [host]': 'Traces the network route to a host.', 
            'whois [domain]': 'Looks up information about a domain.', 
            'ping [host]': 'Checks connectivity to a host.', 
            'clear': 'Clears the terminal screen.',
            'set_identity [id]': 'Assigns a new user identity profile.',
            'scan': 'Scans for hosts on the local network.'
        };
        
        const hrDatabase = {
            "DEVLIN, J.": { "ID": "001-JD", "Title": "Director of Internal Security", "Status": "Active", "Notes": "Oversees the Praetorian Guard project. High-risk individual." },
            "RICHARDS, D.": { "ID": "002-DR", "Title": "Lead Software Engineer", "Status": "Active", "Notes": "Architect of the Gatekeeper system. Unaware of the 'Mozart's Ghost' backdoor." },
            "WINN, S.": { "ID": "003-SW", "Title": "Network Analyst", "Status": "Terminated", "Notes": "Previous analyst assigned to monitor Gatekeeper. Account ghosted after discovering anomalies." },
            "MARX, R.": { "ID": "458-00-3265", "Title": "N/A", "Status": "GHOST", "Notes": "Shell identity. No verifiable background. Used for witness protection and asset relocation." }
        };

        const userList = [
            { name: 'A.BENNETT', level: 3, status: 'GUEST (FLAGGED)' },
            { name: 'J.DEVLIN', level: 9, status: 'ADMINISTRATOR' },
            { name: 'D.RICHARDS', level: 6, status: 'ELEVATED' },
            { name: 'S.WINN', level: 0, status: 'DELETED' },
            { name: 'ROOT', level: 9, status: 'SYSTEM' },
        ];

        const firewallRules = [
            { port: 22, protocol: 'TCP', source: 'ANY', action: 'ALLOW' },
            { port: 80, protocol: 'TCP', source: 'ANY', action: 'ALLOW' },
            { port: 443, protocol: 'TCP', source: 'ANY', action: 'ALLOW' },
            { port: 1337, protocol: 'UDP', source: '13.107.21.200', action: 'DENY' },
            { port: '*', protocol: '*', source: 'ANY', action: 'DENY' },
        ];
        
        // --- AUDIO ---
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        function playBeep(frequency = 800, duration = 0.05, volume = 0.03, type = 'sine') { try { const o=audioContext.createOscillator(),g=audioContext.createGain();o.connect(g),g.connect(audioContext.destination),o.frequency.value=frequency,o.type=type,g.gain.setValueAtTime(volume,audioContext.currentTime),g.gain.exponentialRampToValueAtTime(1e-4,audioContext.currentTime+duration),o.start(audioContext.currentTime),o.stop(audioContext.currentTime+duration)}catch(e){console.error("Audio playback error:", e)}}

        // --- UI & ALERTS ---
        function showAlert(message, duration = 5000) {
            const banner = document.getElementById('alert-banner');
            banner.textContent = message;
            banner.classList.add('show');
            setTimeout(() => banner.classList.remove('show'), duration);
        }

        // --- TERMINAL & COMMANDS ---
        function addTerminalLine(content, className = 'response') { focusWindow(document.getElementById('terminalWindow')); const line=document.createElement('div');line.className='trace-line',line.classList.add(className),line.innerHTML=content,terminalOutput.appendChild(line),scrollTerminal(); return Promise.resolve(line)}
        async function typeTerminalText(text, speed = 15) { focusWindow(document.getElementById('terminalWindow')); const line=document.createElement('div');line.className='trace-line response',terminalOutput.appendChild(line);for(let i=0;i<text.length;i++)await new Promise(r=>setTimeout(r,speed)),line.textContent+=text[i],"\n"===text[i]&&scrollTerminal();scrollTerminal()}
        
        async function processCommand(fullCommand) {
            if (!fullCommand) return;
            await addTerminalLine(`$ ${fullCommand}`, 'command');
            const [command, ...args] = fullCommand.split(' ');
            const arg = args.join(' ');

            switch(command.toLowerCase()) {
                case "help":
                    addTerminalLine("Available commands:","header-info");
                    for(const cmd in commandList) addTerminalLine(`<span class="command">${cmd.padEnd(22," ")}</span> <span class="response">${commandList[cmd]}</span>`);
                    break;
                case "ask":
                    if (clearanceLevel < 9) {
                        await addTerminalLine("Error: Access denied. Insufficient clearance.", "error");
                    } else {
                        await callGemini(arg);
                    }
                    break;
                case "cat":
                    const fileName = arg.toUpperCase();
                    if (fileSystem[fileName]) {
                        if (clearanceLevel >= fileSystem[fileName].requiredLevel) await typeTerminalText(fileSystem[fileName].content);
                        else await addTerminalLine("Error: Access denied. Insufficient clearance.", "error");
                    } else await addTerminalLine(`Error: File not found: ${arg}`, "error");
                    break;
                case "clear":
                    terminalOutput.innerHTML = "";
                    break;
                case "trace": await executeTrace(arg || "cathedral.com"); break;
                case "whois": await executeWhois(arg || "cathedral.com"); break;
                case "ping": await executePing(arg || "cathedral.com"); break;
                case "scan":
                    await addTerminalLine("Scanning local subnet 10.1.1.0/24...", "trace-progress");
                    await new Promise(r => setTimeout(r, 1500));
                    await addTerminalLine("HOSTS FOUND:");
                    await addTerminalLine("10.1.1.1 (GATEWAY) ... ONLINE");
                    await addTerminalLine("10.1.1.5 (HR-SRV-01) ... ONLINE (PROTECTED)");
                    await addTerminalLine("10.1.1.10 (ARCHIVE-DRIVE) ... ONLINE (PROTECTED)");
                    await addTerminalLine("10.1.1.23 (DEVLIN-WS) ... OFFLINE");
                    break;
                case "set_identity":
                    if (clearanceLevel < 6) {
                        await addTerminalLine("Error: Access denied. Insufficient clearance.", "error");
                    } else if (arg.toUpperCase() === 'RUTH MARX') {
                        await addTerminalLine("Identity protocol accepted. Stand by for ghosting...", "trace-progress");
                        await new Promise(r => setTimeout(r, 1500));
                        document.getElementById('userStatus').innerHTML = `USER: R.MARX@<GHOST> - ACCESS LEVEL: ${clearanceLevel} (ELEVATED)`;
                        await addTerminalLine("Identity ghosted successfully.", "success");
                    } else {
                        await addTerminalLine("Error: Identity not found in registry.", "error");
                    }
                    break;
                case "exec_payload":
                    await handleExecPayload(arg);
                    break;
                default:
                    await addTerminalLine(`Command not found: ${command}. Type 'help' for commands.`, 'error');
            }
        }
        async function executeTrace(host){await addTerminalLine(`Tracing route to ${host}...`,"trace-progress"),await new Promise(r=>setTimeout(r,500)),await addTerminalLine("1&nbsp; gateway.home (192.168.1.1)&nbsp; 1.231 ms"),await new Promise(r=>setTimeout(r,500)),await addTerminalLine("2&nbsp; c-24-130-150-1.ca.us.corp.net (24.130.150.1)&nbsp; 10.482 ms"),await new Promise(r=>setTimeout(r,500)),await addTerminalLine("3&nbsp; praetorian-inbound.net (75.75.28.142)&nbsp; 21.904 ms"),await new Promise(r=>setTimeout(r,500)),await addTerminalLine("4&nbsp; GATEKEEPER.CATHEDRAL.COM (204.77.88.15)&nbsp; 25.331 ms","header-info"),await addTerminalLine("Trace complete.","success")}
        async function executeWhois(domain){await addTerminalLine(`Querying WHOIS for ${domain}...`,"trace-progress"),await new Promise(r=>setTimeout(r,800)),await addTerminalLine(`Domain: ${domain.toUpperCase()}`),await addTerminalLine("Registrant: PRAETORIAN GUARD LLC","header-info"),await addTerminalLine("Admin Contact: <DATA EXPUNGED BY GATEKEEPER>","error"),await addTerminalLine("Status: ACTIVE - PROTECTED","success")}
        async function executePing(host){await addTerminalLine(`PING ${host} (204.77.88.15): 56 data bytes`,"response");for(let i=1;4>=i;i++)await new Promise(r=>setTimeout(r,600)),await addTerminalLine(`64 bytes from 204.77.88.15: icmp_seq=${i} ttl=64 time=${(15*Math.random()+10).toFixed(3)} ms`);await addTerminalLine("--- 4 packets transmitted, 4 received, 0% loss ---","success")}
        
        // --- MAIN UI & MODAL ---
        function refreshSidebar() {
            const sidebar = document.getElementById('mainSidebar');
            sidebar.innerHTML = '';
            const mainMenus = ['programs', 'systems', 'commands'];
            mainMenus.forEach(menuKey => {
                const btn = document.createElement('div');
                btn.className = 'menu-button';
                btn.textContent = menuKey.toUpperCase();
                btn.dataset.menu = menuKey; 
                btn.onclick = (e) => selectMenu(e, menuKey);
                sidebar.appendChild(btn);
            });
            
            if (!sidebar.querySelector('.selected')) {
                sidebar.querySelector('.menu-button').classList.add('selected');
            }
        }

        function selectMenu(event, menuType) {
            playBeep(1200, 0.05, 0.04);
            document.querySelectorAll('.sidebar .menu-button').forEach(btn => btn.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            
            const config = menuConfigs[menuType];
            document.getElementById('contentHeader').textContent = config.header;
            const grid = document.getElementById('menuGrid');
            grid.innerHTML = '';
            
            config.items.forEach(item => {
                const menuItem = document.createElement('div');
                menuItem.className = 'menu-item';
                if (item.id === 'facilities-mgmt') {
                    menuItem.classList.add('highlighted');
                }

                menuItem.classList.remove('accessible', 'denied', 'fully-accessible');
                if (clearanceLevel === 9 || clearanceLevel >= item.requiredLevel) {
                    menuItem.classList.add('accessible');
                    if (clearanceLevel === 9) menuItem.classList.add('fully-accessible');
                } else {
                    menuItem.classList.add('denied');
                }
                
                menuItem.onclick = async () => {
                    if (clearanceLevel === 9 || clearanceLevel >= item.requiredLevel) {
                        launchSystem(item.id);
                    } else {
                        playBeep(300, 0.1, 0.04, 'sawtooth');
                        showModal(item.id, true);
                    }
                };
                let lockIcon = '';
                if (item.id === 'network-routing' && clearanceLevel < 6) {
                    lockIcon = '<span>ðŸ”’</span>';
                }
                menuItem.innerHTML = `<div class="lips-logo"></div><div class="menu-item-text">${lockIcon}<div style="white-space: pre-wrap;">${item.name}</div></div>`;
                grid.appendChild(menuItem);
            });
        }
        
        function launchSystem(systemId) { 
            if (systemId === 'facilities-mgmt') {
                const fireSystemWindow = document.getElementById('fireSystemWindow');
                fireSystemWindow.classList.remove('hidden');
                focusWindow(fireSystemWindow);
                return;
            }
            showModal(systemId, false); 
        }
        
        function showModal(type, isDenied = false) {
            const modal = document.getElementById('systemModal'), modalBody = document.getElementById('modalBody'), modalTitle = document.getElementById('modalTitle');
            playBeep(400, .1, .05, "square");
            let content = '';
            modalTitle.textContent = "System Interface";

            // --- BUG FIX: Restore special case for network-routing password prompt ---
            if (isDenied && type !== 'network-routing') {
                type = 'generic-denial';
            }

            switch(type) {
                case 'network-routing':
                    modalTitle.textContent = "Privilege Escalation";
                    content = `<div class="modal-content">This system requires a password to elevate privileges.</div><input type="password" id="routeOverrideInput" class="modal-input" /><div class="modal-btn" id="executeRouteBtn">Execute</div>`;
                    break;
                case 'task-manager':
                    modalTitle.textContent = "Process Task Manager";
                    let processesHTML = processList.map(p => `<li class="${p.protected ? 'protected' : ''}" data-pid="${p.pid}">${p.pid.toString().padEnd(6)}${p.name.padEnd(18)}${p.user}</li>`).join('');
                    content = `<div class="modal-content">Running Processes:</div><ul class="data-list" id="processList">${processesHTML}</ul><div class="modal-btn danger" id="killProcBtn">Terminate Process</div>`;
                    break;
                case 'file-server':
                    modalTitle.textContent = "File Server Explorer";
                    let filesHTML = Object.keys(fileSystem).map(f => `<li class="${clearanceLevel >= fileSystem[f].requiredLevel ? '' : 'locked'}" data-filename="${f}">${f}</li>`).join('');
                    content = `<div class="modal-content">System Files:</div><ul class="data-list" id="fileList">${filesHTML}</ul><div class="modal-btn" id="viewFileBtn">View Selected File</div>`;
                    break;
               case 'hr-storage':
                     modalTitle.textContent = "H.R. Records";
                     let hrHTML = Object.keys(hrDatabase).map(name => `<li data-name="${name}">${name}</li>`).join('');
                     content = `<div class="modal-content">Employee Records:</div><ul class="data-list" id="hrRecords">${hrHTML}</ul><div class="modal-btn" id="viewRecordBtn">View Record</div>`;
                     break;
                case 'mail-server':
                    modalTitle.textContent = "Mail Server";
                    let emailsHTML = emails.map((email, index) => `<li data-email-id="${index}">FROM: ${email.from} - RE: ${email.subject}</li>`).join('');
                    content = `<div class="modal-content">Inbox:</div><ul class="data-list" id="emailList">${emailsHTML}</ul><div id="email-body" style="text-align:left; white-space:pre-wrap; background: #fff; border: 1px inset; padding: 5px; height: 100px; overflow-y:scroll;">Select an email to view.</div>`;
                    break;
                case 'user-mgmt':
                    modalTitle.textContent = "User Management";
                    let usersHTML = userList.map(u => `<li>${u.name.padEnd(12)} LVL: ${u.level} | ${u.status}</li>`).join('');
                    content = `<div class="modal-content">System Users:</div><ul class="data-list">${usersHTML}</ul><div class="modal-btn">Modify</div> <div class="modal-btn">Delete</div>`;
                    break;
                case 'firewall':
                    modalTitle.textContent = "Firewall Control";
                    let rulesHTML = firewallRules.map(r => `<div class="firewall-rule"><span>${r.protocol.padEnd(4)} Port ${r.port.toString().padEnd(5)} from ${r.source}</span><div class="toggle-switch ${r.action === 'ALLOW' ? 'active' : ''}"></div></div>`).join('');
                    content = `<div class="modal-content" style="text-align:left;">${rulesHTML}</div><div class="modal-btn">Save Changes</div>`;
                    break;
                case 'about':
                    modalTitle.textContent = "About Gatekeeper";
                    content = `<div class="modal-content" style="text-align:left; font-size:11px; white-space:pre-wrap;">GATEKEEPER v2.8
(c) 1995 Cathedral Software

Internal security system developed by the Praetorian Guard project.
AI Assistant powered by Gemini.

Unauthorized access is strictly prohibited and will be logged.</div><div class="modal-btn" id="modalAckBtn">OK</div>`;
                    break;
                case 'security-audit': closeModal(); runSecurityAudit(); return;
                case 'backup-sys': closeModal(); runBackup(); return;
                case 'database': closeModal(); runDBCheck(); return;
                case 'optical-archive': closeModal(); runDataRetrieval(); return;
                case 'sys-integrity': closeModal(); runIntegrityCheck(); return;
                case 'modem-link': closeModal(); addTerminalLine('$ dial 555-LOGS', 'command'); setTimeout(()=>addTerminalLine('NO CARRIER', 'error'), 1500); return;
                default:
                    modalTitle.textContent = "GATEKEEPER SECURITY SYSTEM";
                    content = `<div class="modal-header">ðŸ”’ ACCESS DENIED</div><div class="modal-content">System requires a higher clearance level.</div><div class="modal-btn" id="modalAckBtn">ACKNOWLEDGE</div>`;
            }
            
            modalBody.innerHTML = content;

            const btnHandlers = {
                'network-routing': () => { document.getElementById('executeRouteBtn').onclick = executeRouteOverride; document.getElementById('routeOverrideInput').focus();},
                'task-manager': () => { document.getElementById('killProcBtn').onclick = killSelectedProcess; setupListSelection('processList'); },
                'file-server': () => { document.getElementById('viewFileBtn').onclick = viewSelectedFile; setupListSelection('fileList'); },
                 'hr-storage': () => { document.getElementById('viewRecordBtn').onclick = viewHrRecord; setupListSelection('hrRecords'); },
                'mail-server': () => { 
                    document.querySelectorAll('#emailList li').forEach(li => {
                        li.onclick = (e) => {
                            const emailId = e.target.dataset.emailId;
                            const email = emails[emailId];
                            document.getElementById('email-body').innerHTML = clearanceLevel === 9 ? email.body_clear : email.body_redacted;
                            document.querySelectorAll('#emailList li').forEach(i => i.classList.remove('selected'));
                            e.target.classList.add('selected');
                        };
                    });
                },
                'firewall': () => {
                    document.querySelectorAll('.toggle-switch').forEach(ts => ts.onclick = () => ts.classList.toggle('active'));
                },
                'generic-denial': () => { document.getElementById('modalAckBtn').addEventListener('click', closeModal); },
                'about': () => { document.getElementById('modalAckBtn').addEventListener('click', closeModal); }
            };
            
            if (btnHandlers[type]) {
                btnHandlers[type]();
            }
            
            modal.classList.remove('hidden');
        }

        function setupListSelection(listId) {
            document.querySelectorAll(`#${listId} li`).forEach(li => li.onclick = (e) => {
                if (e.target.classList.contains('locked')) return;
                document.querySelectorAll(`#${listId} li`).forEach(i => i.classList.remove('selected'));
                e.target.classList.add('selected');
            });
        }
        
        // --- Fleshed out Feature Functions ---
        async function runSecurityAudit(){
            await addTerminalLine("$ run security.audit",'command');
            await addTerminalLine("Scanning system logs for anomalies...","trace-progress");
            await new Promise(r=>setTimeout(r,1e3));
            if (clearanceLevel >= 6) {
                await addTerminalLine("LEVEL 6+ SCAN COMPLETE. DISPLAYING FULL LOG:","success");
                await typeTerminalText("[10:25] ALERT: Failed login for 'root' from 13.107.21.200\n[10:26] PACKET_CAPTURE: Plaintext password 'natoar23ae' detected in transit.\n[10:28] AUTH: Login success for 'j.devlin' from 13.107.21.200",25);
            } else {
                await addTerminalLine("LEVEL 3 SCAN COMPLETE. DISPLAYING REDACTED LOG:","header-info");
                await typeTerminalText("[10:22] ALERT: Port scan detected from [REDACTED]\n[10:25] ALERT: Failed login for 'root' from [REDACTED]\n[10:26] PACKET_CAPTURE: Plaintext password 'natoar23ae' detected.",25);
                await addTerminalLine("Hint: Use password on a restricted system to elevate privileges.", "header-info");
            }
        }
        function executeRouteOverride() {
            const input = document.getElementById('routeOverrideInput').value;
            closeModal();
            if (input.trim() === 'natoar23ae') {
                runPrivilegeEscalation();
            } else {
                addTerminalLine(`$ admin_override ********`,'command');
                setTimeout(()=>addTerminalLine('Error: Invalid password.', 'error'), 500);
            }
        }
        async function runDiagnostics() {await addTerminalLine('$ ./diag --all','command');await new Promise(r=>setTimeout(r,500));await addTerminalLine('Checking CPU... <span class="success">OK</span>');await new Promise(r=>setTimeout(r,500));await addTerminalLine('Checking Memory... <span class="success">OK</span>');await new Promise(r=>setTimeout(r,500));await addTerminalLine('Checking Network Controller... <span class="success">OK</span>');await new Promise(r=>setTimeout(r,500));await addTerminalLine('All systems nominal.', 'success');}
        
        async function killSelectedProcess() {
            const selected = document.querySelector('#processList li.selected');
            if (!selected) return;
            const pid = selected.dataset.pid;
            const process = processList.find(p => p.pid == pid);
            closeModal();
            await addTerminalLine(`$ kill -9 ${pid}`, 'command');

            if (pid === '489') { // Easter egg for killing gatekeeper.exe
                await new Promise(r => setTimeout(r, 500));
                await addTerminalLine("Attempting to terminate GATEKEEPER.EXE...", "cathedral-warning");
                await new Promise(r => setTimeout(r, 1000));
                await addTerminalLine("MEMORY CORRUPTION DETECTED. SELF-PRESERVATION PROTOCOL ACTIVE.", "error");
                document.querySelector('.monitor').style.filter = 'contrast(2) brightness(1.5) hue-rotate(90deg)';
                await new Promise(r => setTimeout(r, 200));
                document.querySelector('.monitor').style.filter = '';
                await addTerminalLine("...protocol failed. System unstable.", "error");
                return;
            }

            setTimeout(async () => {
                if (process.protected) {
                    await addTerminalLine(`ERROR: Access denied. Process ${pid} is protected by GATEKEEPER.`, "error");
                } else {
                    await addTerminalLine(`Process ${pid} terminated.`, "success");
                }
            }, 500);
        }

        function viewSelectedFile() {const selected=document.querySelector('#fileList li.selected');if(!selected)return;const filename=selected.dataset.filename;closeModal(),processCommand(`cat ${filename}`)}
        
        async function runBackup() {
            await addTerminalLine('$ ./backup --full','command');
            const confirmLine = document.createElement('div');
            confirmLine.className = 'trace-line';
            confirmLine.innerHTML = `<span>This will overwrite the last backup. Proceed? (Y/N): </span><span id="confirmInput" contenteditable="false"></span><span class="cursor">â–ˆ</span>`;
            terminalOutput.appendChild(confirmLine);
            scrollTerminal();
            terminalState = 'backup_confirm';
            document.getElementById('main-input-line').classList.add('hidden');
        }
        async function runDBCheck() {await addTerminalLine('$ ./db_check --verify','command');await addTerminalLine('Verifying database integrity...','trace-progress');await new Promise(r=>setTimeout(r,1500));await addTerminalLine('No errors found.','success');}
        async function runDataRetrieval() {
            await addTerminalLine('$ ./tape_archive -r latest','command');
            await addTerminalLine('Accessing optical archive... Spooling tape...', 'trace-progress');
            await new Promise(r => setTimeout(r, 1000));
            await addTerminalLine('Reading sector 1... OK', 'response');
            await new Promise(r => setTimeout(r, 1000));
            await addTerminalLine('Reading sector 2... OK', 'response');
            await new Promise(r => setTimeout(r, 1500));
            await addTerminalLine('Reading sector 3... <span class="error">CRC ERROR</span>', 'error');
            await addTerminalLine('Attempting recovery...', 'trace-progress');
            await new Promise(r => setTimeout(r, 2000));
            await addTerminalLine('Data recovery partial. Displaying fragment:', 'header-info');
            await typeTerminalText("...rotocol active... Praetorian Guard... compromised... ghost identity protocol is the only... find Mozart...", 30);
        }
        
        // --- BUG FIX: Changed HR records to display in console ---
        async function viewHrRecord() {
            const selected = document.querySelector('#hrRecords li.selected');
            if (!selected) return;
            const recordName = selected.dataset.name;
            const record = hrDatabase[recordName];
            if (!record) return;
            closeModal();
            
            await addTerminalLine(`$ view_record "${recordName}"`, 'command');
            let recordText = `NAME:   ${recordName}\n`;
            recordText += `ID:     ${record.ID}\n`;
            recordText += `TITLE:  ${record.Title}\n`;
            recordText += `STATUS: ${record.Status}\n\n`;
            recordText += `NOTES:\n${record.Notes}`;
            await typeTerminalText(recordText);
        }
        
        async function runIntegrityCheck() {
            await addTerminalLine('$ ./chk_integrity --kernel --verbose', 'command');
            await addTerminalLine('Starting kernel integrity scan...', 'trace-progress');
            await new Promise(r => setTimeout(r, 1000));
            await addTerminalLine('Verifying checksum for KERNEL32.DLL... <span class="success">OK</span>');
            await new Promise(r => setTimeout(r, 500));
            await addTerminalLine('Scanning system call table for hooks... <span class="success">OK</span>');
            await new Promise(r => setTimeout(r, 1000));
            await addTerminalLine('Checking memory registers... <span class="success">OK</span>');
            await new Promise(r => setTimeout(r, 500));
            await addTerminalLine('System integrity verified.', 'success');
        }

        function closeModal(){
            const modal=document.getElementById("systemModal");
            if(!modal.classList.contains("hidden")) {
                playBeep(600,.05,.03);
                modal.classList.add("hidden");
            }
        }
        
        function updateStatusBar() {
            const userType = document.getElementById('userTypeStatus');
            const systemLoad = document.getElementById('systemLoadStatus');
            if (clearanceLevel === 3) {
                userType.textContent = "USER TYPE: GUEST";
                systemLoad.textContent = "SYSTEM LOAD: NOMINAL";
            } else if (clearanceLevel === 6) {
                userType.textContent = "USER TYPE: ELEVATED";
                systemLoad.innerHTML = `SYSTEM LOAD: <span style="color:orange;font-weight:bold;">HIGH</span>`;
            } else if (clearanceLevel === 9) {
                userType.textContent = "USER TYPE: ADMINISTRATOR";
                systemLoad.innerHTML = `SYSTEM LOAD: <span style="color:red;font-weight:bold;">CRITICAL</span>`;
            }
        }

        async function runPrivilegeEscalation() {
            await addTerminalLine('$ ./exploit/route_poison.sh','command');
            await addTerminalLine('Initializing memory heap spray...', 'trace-progress');
            await new Promise(r => setTimeout(r, 1500));
            await addTerminalLine('SUCCESS: Return pointer overwritten.', 'success');
            await new Promise(r => setTimeout(r, 500));
            await addTerminalLine('Spawning new shell with elevated privileges...', 'trace-progress');
            await new Promise(r => setTimeout(r, 1000));
            clearanceLevel = 6;
            document.getElementById('userStatus').innerHTML = `USER: A.BENNETT@CATHEDRAL.COM - ACCESS LEVEL: ${clearanceLevel} (ELEVATED)`;
            updateStatusBar();
            await addTerminalLine(`Clearance Level upgraded: 3 -> 6`, 'success');
            
            const previouslySelectedKey = document.querySelector('#mainSidebar .selected')?.dataset.menu || 'programs';
            refreshSidebar();
            const newSelectionTarget = document.querySelector(`#mainSidebar .menu-button[data-menu='${previouslySelectedKey}']`);
            if (newSelectionTarget) {
                selectMenu({currentTarget: newSelectionTarget}, previouslySelectedKey);
            }
        }

        async function triggerPiExploit() {
            if (clearanceLevel === 9) return;
            clearanceLevel = 9;
            const pi=document.querySelector(".pi-symbol");
            pi.style.transform="scale(1.5) rotate(720deg)";
            pi.style.color="#00ff00";
            pi.style.textShadow="0 0 15px #00ff00, 0 0 25px #00ff00";
            for(let i=0;5>i;i++)playBeep(800+200*i,.1,.05),await new Promise(r=>setTimeout(r,150));
            await addTerminalLine('Ï€ SYMBOL ACTIVATED - "MOZART\'S GHOST" INITIATED',"cathedral-warning");
            await addTerminalLine("Bypassing GATEKEEPER authentication matrix...","trace-progress");
            await new Promise(r => setTimeout(r, 1000));
            await addTerminalLine("*** ALL PRIVILEGES GRANTED. ***","success"),
            await addTerminalLine("Welcome back, Angela.","success");
            const securityLed=document.getElementById("securityLed");
            securityLed.classList.remove("warning","error");
            securityLed.classList.add("success");
            securityLed.style.background="var(--terminal-success)";
            securityLed.style.boxShadow="0 0 5px var(--terminal-success)";
            document.getElementById("securityStatus").textContent="Security: Bypassed";
            document.getElementById("userStatus").innerHTML=`USER: A.BENNETT@CATHEDRAL.COM - ACCESS LEVEL: ${clearanceLevel} (ADMINISTRATOR)`;
            updateStatusBar();
            refreshSidebar();
            const currentSelection = document.querySelector('#mainSidebar .selected');
            if (currentSelection) {
                selectMenu({currentTarget: currentSelection}, currentSelection.dataset.menu);
            }
        }
        
        async function handleExecPayload(arg) {
            if (clearanceLevel < 9) {
                await addTerminalLine("Error: ROOT PRIVILEGES REQUIRED TO EXECUTE PAYLOAD.", "error");
                playBeep(300, 0.2, 0.05, 'sawtooth');
                return;
            }
            if (arg.toLowerCase() !== 'wolfenstein3d.exe') {
                await addTerminalLine("Error: Invalid payload specified.", "error");
                return;
            }

            await addTerminalLine("Payload selected: wolfenstein3d.exe", "header-info");
            await addTerminalLine("This action is irreversible and will cause catastrophic system failure.", "cathedral-warning");
            
            const confirmLine = document.createElement('div');
            confirmLine.className = 'trace-line';
            confirmLine.innerHTML = `<span>CONFIRM EXECUTION (Y/N): </span><span id="confirmInput" contenteditable="false"></span><span class="cursor">â–ˆ</span>`;
            terminalOutput.appendChild(confirmLine);
            scrollTerminal();
            
            terminalState = 'confirm';
            document.getElementById('main-input-line').classList.add('hidden');
        }

        async function handleConfirmation(input) {
            const confirmInput = document.getElementById('confirmInput');
            if (confirmInput) {
                confirmInput.parentElement.innerHTML = `<span>CONFIRM EXECUTION (Y/N): ${input}</span>`;
            }

            if (input.toLowerCase() === 'y') {
                await addTerminalLine("Confirmation received. Injecting payload into kernel memory...", "trace-progress");
                await new Promise(r => setTimeout(r, 1500));
                await addTerminalLine("Payload accepted. Triggering kernel panic.", "cathedral-warning");
                await new Promise(r => setTimeout(r, 500));
                runEndgame();
            } else {
                await addTerminalLine("Payload execution aborted by user.", "header-info");
            }
            terminalState = 'command';
            document.getElementById('main-input-line').classList.remove('hidden');
        }

        function triggerPixelationEffect() {
            const overlay = document.getElementById('pixel-overlay');
            let step = 0;
            const steps = [4, 8, 16, 32, 64, 128]; 
            
            const interval = setInterval(() => {
                const pixelSize = steps[step];
                if (!pixelSize) {
                    clearInterval(interval);
                    return;
                }
                const newCols = Math.ceil(window.innerWidth / pixelSize);
                const newRows = Math.ceil(window.innerHeight / pixelSize);
                overlay.innerHTML = '';
                overlay.style.gridTemplateColumns = `repeat(${newCols}, 1fr)`;
                overlay.style.gridTemplateRows = `repeat(${newRows}, 1fr)`;
                
                for (let i = 0; i < newCols * newRows; i++) {
                    const pixel = document.createElement('div');
                    pixel.className = 'pixel';
                    pixel.style.backgroundColor = `rgb(${Math.random()*50}, ${Math.random()*50}, ${Math.random()*150 + 100})`;
                    overlay.appendChild(pixel);
                }
                step++;
            }, 400);
        }

        async function runEndgame() {
            playBeep(200, 1.5, 0.1, 'square');
            triggerPixelationEffect();

            setTimeout(() => {
                const bsod = document.createElement('div');
                bsod.className = 'bsod';
                bsod.innerHTML = `<h1>A fatal exception has occurred at 0x28:C0011E36 in VXD GATEKEEPER(01)</h1><p>The system has been halted.</p><br><p>* Press any key to restart</p><br><br><p>CONNECTION TERMINATED</p>`;
                document.body.appendChild(bsod);
                window.addEventListener('keydown', () => window.location.reload(), { once: true });
            }, 2500);
        }

        async function handleMenuAction(action) {
            switch(action) {
                case 'logoff':
                case 'reboot':
                    await addTerminalLine("System shutdown requested.", "header-info");
                    const confirmLine = document.createElement('div');
                    confirmLine.className = 'trace-line';
                    confirmLine.innerHTML = `<span>ARE YOU SURE? (Y/N): </span><span id="confirmInput" contenteditable="false"></span><span class="cursor">â–ˆ</span>`;
                    terminalOutput.appendChild(confirmLine);
                    scrollTerminal();
                    terminalState = 'reboot_confirm';
                    document.getElementById('main-input-line').classList.add('hidden');
                    break;
                case 'diagnostics':
                    runDiagnostics();
                    break;
                case 'network_status':
                    const networkWindow = document.getElementById('networkWindow');
                    networkWindow.classList.remove('hidden');
                    focusWindow(networkWindow);
                    break;
                case 'about':
                    showModal('about');
                    break;
            }
        }

        async function handleRebootConfirmation(input) {
            const confirmInput = document.getElementById('confirmInput');
            if (confirmInput) {
                confirmInput.parentElement.innerHTML = `<span>ARE YOU SURE? (Y/N): ${input}</span>`;
            }
            if (input.toLowerCase() === 'y') {
                await addTerminalLine("Rebooting...", "cathedral-warning");
                document.querySelector('.monitor').style.opacity = '0';
                setTimeout(() => window.location.reload(), 500);
            } else {
                await addTerminalLine("Reboot aborted.", "header-info");
            }
            terminalState = 'command';
            document.getElementById('main-input-line').classList.remove('hidden');
        }

        async function handleBackupConfirmation(input) {
            const confirmInput = document.getElementById('confirmInput');
            if (confirmInput) {
                confirmInput.parentElement.innerHTML = `<span>This will overwrite the last backup. Proceed? (Y/N): ${input}</span>`;
            }
            if (input.toLowerCase() === 'y') {
                await addTerminalLine("Backup started...", "trace-progress");
                const line = await addTerminalLine("<span class='flashing-text'>**INSERT FLOPPY DISK**</span>", "cathedral-warning");
                await new Promise(r => setTimeout(r, 4000));
                line.innerHTML = "ERROR: NO FLOPPY DETECTED IN DRIVE A:";
                await addTerminalLine("Backup failed.", "error");
            } else {
                await addTerminalLine("Backup aborted by user.", "header-info");
            }
            terminalState = 'command';
            document.getElementById('main-input-line').classList.remove('hidden');
        }
        
        // --- GEMINI API INTEGRATION ---
        async function callGemini(prompt) {
            await addTerminalLine("Contacting System AI Assistant...", "trace-progress");
            let chatHistory = [{ role: "user", parts: [{ text: `You are an AI assistant inside a 1990s computer system called Gatekeeper. Your name is 'Praetorian'. Respond to the user's query in a concise, retro, cyberpunk style. The user is a hacker trying to uncover a conspiracy. The query is: '${prompt}'` }] }];
            const payload = { contents: chatHistory };
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            let response;
            let retries = 0;
            const maxRetries = 5;
            let success = false;

            while (retries < maxRetries && !success) {
                try {
                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        if (result.candidates && result.candidates[0] && result.candidates[0].content.parts[0]) {
                            const text = result.candidates[0].content.parts[0].text;
                            await typeTerminalText(`PRAETORIAN: ${text}`);
                            success = true;
                        } else {
                            throw new Error("Invalid API response structure");
                        }
                    } else {
                        throw new Error(`API request failed with status ${response.status}`);
                    }
                } catch (error) {
                    retries++;
                    if (retries < maxRetries) {
                        const delay = Math.pow(2, retries) * 100;
                        await new Promise(res => setTimeout(res, delay));
                    } else {
                        await addTerminalLine("AI Assistant offline. Connection failed.", "error");
                    }
                }
            }
        }

        // --- INITIALIZATION & EVENT LISTENERS ---
        function scrollTerminal() { terminal.scrollTop = terminal.scrollHeight; }
        
        function focusWindow(win) {
            let maxZ = 0;
            document.querySelectorAll(".window").forEach(w => {
                const z = parseInt(window.getComputedStyle(w).zIndex) || 0;
                if (z > maxZ) maxZ = z;
            });
            win.style.zIndex = maxZ + 1;
        }

        function makeDraggable(win) { 
            win.addEventListener('mousedown', () => focusWindow(win));
            const title=win.querySelector(".title-bar");
            if (!title) return;
            title.addEventListener("mousedown",e=>{
                let offsetX=e.clientX-win.offsetLeft,offsetY=e.clientY-win.offsetTop;
                title.classList.add("dragging");
                const mouseMove=e=>{
                    win.style.left=`${e.clientX-offsetX}px`;
                    win.style.top=`${e.clientY-offsetY}px`;
                };
                const mouseUp=()=>{
                    document.removeEventListener("mousemove",mouseMove);
                    document.removeEventListener("mouseup",mouseUp);
                    title.classList.remove("dragging");
                };
                document.addEventListener("mousemove",mouseMove);
                document.addEventListener("mouseup",mouseUp);
            });
        }
        
        let isModalInputActive = false;
        function handleGlobalInput(e){
            if(isModalInputActive) return;

            let currentInputEl;
            if (terminalState === 'command') {
                currentInputEl = document.getElementById('commandInput');
            } else {
                currentInputEl = document.getElementById('confirmInput');
            }
            
            if (!currentInputEl) return;

            if (e.key === "Enter") {
                e.preventDefault();
                const content = currentInputEl.textContent.trim();
                currentInputEl.textContent = "";
                if (terminalState === 'command') processCommand(content);
                else if (terminalState === 'confirm') handleConfirmation(content);
                else if (terminalState === 'reboot_confirm') handleRebootConfirmation(content);
                else if (terminalState === 'backup_confirm') handleBackupConfirmation(content);
            } else if (e.key === "Backspace") {
                currentInputEl.textContent = currentInputEl.textContent.slice(0, -1);
            } else if (e.key.length === 1 && !e.ctrlKey && !e.metaKey) {
                currentInputEl.textContent += e.key;
            }
        }

        document.addEventListener("keydown",e=>{
            const modalIsVisible=!document.getElementById("systemModal").classList.contains("hidden");
            if(modalIsVisible) {
                const modalInput = document.getElementById('routeOverrideInput');
                isModalInputActive = (modalInput && document.activeElement === modalInput);
                
                if (isModalInputActive) {
                    if (e.key === 'Enter') executeRouteOverride();
                } else {
                    if (e.key === 'Escape' || e.key === 'Enter') closeModal();
                }
            } else {
                isModalInputActive = false;
                handleGlobalInput(e);
            }
        });
        
        document.addEventListener("DOMContentLoaded",()=>{
            document.querySelectorAll(".window").forEach(makeDraggable);
            document.getElementById("modalCloseBtn").addEventListener("click",closeModal);
            
            refreshSidebar();
            selectMenu({currentTarget: document.querySelector('#mainSidebar .menu-button')}, 'programs');

            document.getElementById("cathedral-icon").addEventListener('dblclick', () => {
                const mainMenu = document.getElementById('mainMenu');
                mainMenu.classList.remove('hidden');
                focusWindow(mainMenu);
            });
            document.getElementById("network-icon").addEventListener('dblclick', () => {
                const networkWindow = document.getElementById('networkWindow');
                networkWindow.classList.remove('hidden');
                focusWindow(networkWindow);
            });

            document.querySelectorAll('.fire-zone').forEach(zone => {
                zone.addEventListener('click', () => {
                    if (activeAlarmTimers.length > 0) return; 
                    const zoneName = zone.dataset.zone;
                    zone.classList.add('active');
                    
                    const cancelBtn = document.getElementById('cancelAlarmBtn');
                    const cancelHandler = () => {
                        addTerminalLine(`ALARM IN ${zoneName} MANUALLY CANCELLED.`, 'success');
                        activeAlarmTimers.forEach(timerId => clearTimeout(timerId));
                        activeAlarmTimers = [];
                        zone.classList.remove('active');
                        cancelBtn.removeEventListener('click', cancelHandler);
                    };
                    cancelBtn.addEventListener('click', cancelHandler, { once: true });

                    addTerminalLine(`FIRE SUPPRESSION TRIGGERED: ${zoneName}`, 'cathedral-warning');

                    activeAlarmTimers.push(setTimeout(() => {
                        addTerminalLine(`SPRINKLER SYSTEM ACTIVATED IN ${zoneName}.`, 'trace-progress');
                    }, 5000));

                    activeAlarmTimers.push(setTimeout(() => {
                        addTerminalLine(`HALON GAS DEPLOYMENT IMMINENT IN ${zoneName}.`, 'cathedral-warning');
                    }, 15000));

                    activeAlarmTimers.push(setTimeout(() => {
                        zone.classList.remove('active');
                        addTerminalLine(`SYSTEM RESET: ${zoneName}`, 'success');
                        activeAlarmTimers = [];
                        cancelBtn.removeEventListener('click', cancelHandler);
                    }, 20000));
                });
            });

            setInterval(()=>document.getElementById("currentTime").textContent=(new Date).toLocaleTimeString(),1e3);
            addTerminalLine("Gatekeeper Systems Online. Type 'help' for available commands.","success");
            showAlert("UNAUTHORIZED PORT SCAN DETECTED");

            const uplinkNeedle = document.getElementById('uplink-needle');
            const downlinkNeedle = document.getElementById('downlink-needle');
            const packetFlow = document.getElementById('packet-flow');
            const latency = document.getElementById('latency');
            const serverStatus = document.getElementById('server-status-text');
            const hexDump = document.getElementById('hex-dump');

            setInterval(() => {
                if(uplinkNeedle) uplinkNeedle.style.transform = `rotate(${-80 + Math.random() * 160}deg)`;
                if(downlinkNeedle) downlinkNeedle.style.transform = `rotate(${-80 + Math.random() * 160}deg)`;
                if(packetFlow) packetFlow.textContent = Math.floor(Math.random() * 5000 + 2000);
                if(latency) latency.textContent = Math.floor(Math.random() * 30 + 10);
                if (serverStatus && Math.random() > 0.95) {
                    serverStatus.innerHTML = `SERVER STATUS: <span class="error">PACKET LOSS</span>`;
                } else if (serverStatus) {
                    serverStatus.innerHTML = `SERVER STATUS: <span class="success">NOMINAL</span>`;
                }
                if(hexDump) {
                    let hexString = '';
                    for(let i = 0; i < 4; i++) {
                        hexString += Array.from({length: 16}, () => Math.floor(Math.random() * 256).toString(16).padStart(2, '0')).join(' ') + '\n';
                    }
                    hexDump.textContent = hexString;
                }
            }, 1000);
        });

    </script>
</body>
</html>
